!function(){"use strict";const e={serverUrl:"https://alfred-portfolio-bot.vercel.app",position:"bottom-right",theme:"dark",showPulse:!0,autoOpen:!1,tenantId:null},t=document.currentScript;if(t){const n=t.getAttribute("data-tenant-id");n&&(e.tenantId=n);const i=t.getAttribute("data-server-url");i&&(e.serverUrl=i);const s=t.getAttribute("data-position");s&&(e.position=s);const a=t.getAttribute("data-theme");a&&(e.theme=a)}const n=`\n        <div class="alfred-widget" id="alfredWidget">\n            <button class="alfred-widget-toggle" id="alfredToggle">\n                ${e.showPulse?'<div class="pulse"></div>':""}\n                <i class="fas fa-robot"></i>\n            </button>\n            \n            <div class="alfred-widget-overlay" id="alfredOverlay"></div>\n            \n            <div class="alfred-widget-panel" id="alfredPanel">\n                <div class="alfred-widget-header">\n                    <div class="alfred-widget-header-left">\n                        <div class="alfred-widget-avatar">\n                            <i class="fas fa-robot"></i>\n                        </div>\n                        <div>\n                            <h3 class="alfred-widget-title">JIA</h3>\n                            <p class="alfred-widget-subtitle">Jeeva's AI Assistant â€¢ May make mistakes</p>\n                        </div>\n                    </div>\n                    <button class="alfred-widget-close" id="alfredClose">\n                        <i class="fas fa-times"></i>\n                    </button>\n                </div>\n                \n                <div class="alfred-widget-content">\n                    <div class="alfred-widget-greeting">\n                        <h3>Hello! ðŸ‘‹</h3>\n                        <p>I'm JIA, Jeeva's AI assistant. Ask me anything about his work, skills, or experience!</p>\n                    </div>\n                    \n                    <div class="alfred-widget-chat" id="alfredChat">\n                        <div class="alfred-widget-message alfred">\n                            <div class="alfred-widget-message-avatar">\n                                <i class="fas fa-robot"></i>\n                            </div>\n                            <div class="alfred-widget-message-bubble">\n                                Hi there! I'm JIA, Jeeva's personal AI assistant. I strive to be helpful but I may make mistakes â€” please verify important information. How can I assist you today?\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class="alfred-widget-input-area">\n                        <div class="alfred-widget-input-wrapper">\n                            <textarea \n                                class="alfred-widget-input" \n                                id="alfredInput" \n                                placeholder="Ask JIA about Jeeva's work..."\n                                rows="1"\n                            ></textarea>\n                            <button class="alfred-widget-send" id="alfredSend">\n                                <i class="fas fa-paper-plane"></i>\n                            </button>\n                        </div>\n                        <div class="alfred-widget-suggestions">\n                            <div class="alfred-widget-suggestion" data-suggestion="What are Jeeva's main skills?">Skills</div>\n                            <div class="alfred-widget-suggestion" data-suggestion="Tell me about Jeeva's projects">Projects</div>\n                            <div class="alfred-widget-suggestion" data-suggestion="What is Jeeva's experience?">Experience</div>\n                            <div class="alfred-widget-suggestion" data-suggestion="How can I contact Jeeva?">Contact</div>\n                        </div>\n                        <div class="alfred-widget-disclaimer">AI can make mistakes. For critical decisions, doubleâ€‘check important info.</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;class i{constructor(e){this.config=e,this.isOpen=!1,this.socket=null,this.sessionId=this.generateSessionId(),this.initializeWidget()}initializeWidget(){if(!document.getElementById("alfred-widget-styles")){const e=document.createElement("div");e.innerHTML="\n        <style id=\"alfred-widget-styles\">\n            /* JIA Bot Widget Styles - Clean, Intercom-like */\n            .alfred-widget {\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                z-index: 10000;\n                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            }\n\n            .alfred-widget-toggle {\n                width: 60px;\n                height: 60px;\n                background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);\n                border-radius: 50%;\n                border: none;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: #fff;\n                font-size: 24px;\n                box-shadow: 0 10px 30px rgba(37, 99, 235, 0.35);\n                transition: transform .2s ease, box-shadow .2s ease, background .2s ease;\n                position: relative;\n            }\n\n            .alfred-widget-toggle:hover { transform: scale(1.06); box-shadow: 0 14px 34px rgba(37, 99, 235, 0.45); }\n            .alfred-widget-toggle.active { background: linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%); }\n\n            .alfred-widget-toggle .pulse {\n                position: absolute; inset: -2px; border-radius: 50%;\n                background: rgba(37, 99, 235, 0.28);\n                animation: alfred-pulse 2s infinite;\n            }\n            @keyframes alfred-pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.35); opacity: 0; } }\n\n            /* Floating panel */\n            .alfred-widget-panel {\n                position: fixed;\n                bottom: 90px;\n                right: 20px;\n                width: 380px;\n                max-width: calc(100vw - 40px);\n                height: min(70vh, 620px);\n                background: #ffffff;\n                color: #0f172a;\n                border-radius: 16px;\n                border: 1px solid rgba(15, 23, 42, 0.08);\n                box-shadow: 0 24px 60px rgba(2, 6, 23, 0.18), 0 8px 18px rgba(2, 6, 23, 0.12);\n                z-index: 10001;\n                display: flex;\n                flex-direction: column;\n                opacity: 0;\n                transform: translateY(12px) scale(.98);\n                visibility: hidden;\n                pointer-events: none;\n                transition: opacity .2s ease, transform .2s ease, visibility .2s ease;\n            }\n            .alfred-widget-panel.open { opacity: 1; transform: translateY(0) scale(1); visibility: visible; pointer-events: auto; }\n\n            .alfred-widget-header {\n                padding: 12px 14px;\n                background: #ffffff;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                border-bottom: 1px solid rgba(15, 23, 42, 0.08);\n                border-top-left-radius: 16px;\n                border-top-right-radius: 16px;\n            }\n            .alfred-widget-header-left { display: flex; align-items: center; gap: 10px; }\n            .alfred-widget-avatar { width: 28px; height: 28px; background: #eff6ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; border: 1px solid rgba(37, 99, 235, 0.35); color: #1d4ed8; }\n            .alfred-widget-title { font-size: 14px; font-weight: 600; margin: 0; line-height: 1; color: #0f172a; }\n            .alfred-widget-subtitle { font-size: 12px; margin: 2px 0 0 0; color: #64748b; }\n\n            .alfred-widget-close { background: none; border: none; color: #334155; font-size: 18px; cursor: pointer; padding: 6px; border-radius: 6px; transition: background .15s ease; }\n            .alfred-widget-close:hover { background: rgba(15, 23, 42, 0.06); }\n\n            .alfred-widget-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }\n\n            .alfred-widget-greeting { padding: 14px; text-align: left; background: #f8fafc; border-bottom: 1px solid rgba(15,23,42,0.06); }\n            .alfred-widget-greeting h3 { font-size: 16px; margin: 0 0 6px 0; font-weight: 600; color: #0f172a; }\n            .alfred-widget-greeting p { font-size: 13px; margin: 0; color: #475569; }\n            .alfred-widget-disclaimer { padding: 8px 14px; font-size: 11px; color: #94a3b8; background: #f8fafc; border-top: 1px solid rgba(15,23,42,0.06); }\n\n            .alfred-widget-chat { flex: 1; padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }\n            .alfred-widget-message { display: flex; gap: 10px; align-items: flex-start; }\n            .alfred-widget-message.user { flex-direction: row-reverse; }\n            .alfred-widget-message-avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; }\n            .alfred-widget-message.alfred .alfred-widget-message-avatar { background: #eff6ff; color: #1d4ed8; border: 1px solid rgba(37,99,235,.35); }\n            .alfred-widget-message.user .alfred-widget-message-avatar { background: linear-gradient(135deg, #64748b, #475569); color: #fff; }\n            .alfred-widget-message-bubble { max-width: 80%; padding: 10px 14px; border-radius: 14px; font-size: 14px; line-height: 1.45; border: 1px solid transparent; }\n            .alfred-widget-message.alfred .alfred-widget-message-bubble { background: #f1f5f9; color: #0f172a; border-color: #e2e8f0; }\n            .alfred-widget-message.user .alfred-widget-message-bubble { background: linear-gradient(135deg, #2563eb, #3b82f6); color: #fff; }\n\n            .alfred-widget-input-area { padding: 12px; background: #ffffff; border-top: 1px solid rgba(15, 23, 42, 0.08); border-bottom-left-radius: 16px; border-bottom-right-radius: 16px; }\n            .alfred-widget-input-wrapper { display: flex; gap: 10px; align-items: flex-end; background: #f8fafc; border-radius: 12px; padding: 10px; border: 1px solid #e2e8f0; }\n            .alfred-widget-input { flex: 1; background: none; border: none; outline: none; color: #0f172a; font-size: 16px; /* prevent iOS zoom */ resize: none; min-height: 20px; max-height: 100px; font-family: inherit; }\n            .alfred-widget-input::placeholder { color: #94a3b8; }\n            .alfred-widget-send { width: 36px; height: 36px; background: linear-gradient(135deg, #2563eb, #3b82f6); border: none; border-radius: 50%; color: #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform .15s ease; flex-shrink: 0; }\n            .alfred-widget-send:hover { transform: scale(1.06); }\n\n            .alfred-widget-suggestions { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }\n            .alfred-widget-suggestion { background: #f1f5f9; border: 1px solid #e2e8f0; color: #0f172a; padding: 6px 10px; border-radius: 14px; font-size: 12px; cursor: pointer; transition: transform .15s ease, background .15s ease; }\n            .alfred-widget-suggestion:hover { background: #e2e8f0; transform: translateY(-1px); }\n\n            .alfred-widget-overlay { position: fixed; inset: 0; background: rgba(2, 6, 23, 0.35); z-index: 10000; opacity: 0; visibility: hidden; transition: opacity .2s ease, visibility .2s ease; }\n            .alfred-widget-overlay.open { opacity: 1; visibility: visible; }\n\n            /* Mobile Responsive */\n            @media (max-width: 768px) {\n                .alfred-widget-panel { right: 10px; left: 10px; width: auto; max-width: none; height: min(80vh, 640px); bottom: 80px; }\n                .alfred-widget-toggle { width: 50px; height: 50px; font-size: 20px; bottom: 15px; right: 15px; }\n            }\n\n            /* Scrollbar Styling */\n            .alfred-widget-chat::-webkit-scrollbar { width: 4px; }\n            .alfred-widget-chat::-webkit-scrollbar-track { background: transparent; }\n            .alfred-widget-chat::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.5); border-radius: 2px; }\n            .alfred-widget-chat::-webkit-scrollbar-thumb:hover { background: rgba(100, 116, 139, 0.7); }\n\n            /* Markdown rendering inside bubbles */\n            .alfred-widget-message-bubble .markdown-body { color: inherit; }\n            .alfred-widget-message-bubble .markdown-body p { margin: 0.25rem 0; }\n            .alfred-widget-message-bubble .markdown-body ul,\n            .alfred-widget-message-bubble .markdown-body ol { padding-left: 1.25rem; margin: 0.25rem 0; }\n            .alfred-widget-message-bubble .markdown-body ul { list-style: disc inside; }\n            .alfred-widget-message-bubble .markdown-body ol { list-style: decimal inside; }\n            .alfred-widget-message-bubble .markdown-body li { margin: 0.125rem 0; }\n            .alfred-widget-message-bubble .markdown-body a { color: inherit; text-decoration: underline; }\n            .alfred-widget-message-bubble pre { background: rgba(15,23,42,0.06); padding: 0.75rem; border-radius: 8px; overflow-x: auto; white-space: pre; -webkit-overflow-scrolling: touch; }\n            .alfred-widget-message.user .alfred-widget-message-bubble pre { background: rgba(255,255,255,0.15); }\n            .alfred-widget-message-bubble pre code { background: transparent; padding: 0; }\n            .alfred-widget-message-bubble code { background: rgba(15,23,42,0.06); padding: 0.15rem 0.35rem; border-radius: 4px; font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; }\n            .alfred-widget-message.user .alfred-widget-message-bubble code { background: rgba(255,255,255,0.25); }\n        </style>\n    ",document.head.appendChild(e)}const e=document.createElement("div");e.innerHTML=n,document.body.appendChild(e.firstElementChild),this.initializeElements(),this.bindEvents(),this.initializeSocket(),this.configureMarkdown(),this.config.autoOpen&&setTimeout((()=>this.openPanel()),1e3)}initializeElements(){this.elements={widget:document.getElementById("alfredWidget"),toggle:document.getElementById("alfredToggle"),panel:document.getElementById("alfredPanel"),overlay:document.getElementById("alfredOverlay"),close:document.getElementById("alfredClose"),chat:document.getElementById("alfredChat"),input:document.getElementById("alfredInput"),send:document.getElementById("alfredSend")}}bindEvents(){this.elements.toggle.addEventListener("click",(()=>this.togglePanel())),this.elements.close.addEventListener("click",(()=>this.closePanel())),this.elements.overlay.addEventListener("click",(()=>this.closePanel())),this.elements.send.addEventListener("click",(()=>this.sendMessage())),this.elements.input.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())})),this.elements.input.addEventListener("input",(()=>{this.autoResizeTextarea()})),document.addEventListener("click",(e=>{if(e.target.classList.contains("alfred-widget-suggestion")){const t=e.target.getAttribute("data-suggestion");this.elements.input.value=t,this.sendMessage()}}))}initializeSocket(){try{if("undefined"==typeof io){const e=document.createElement("script");e.src="https://cdn.socket.io/4.7.2/socket.io.min.js",e.onload=()=>this.connectSocket(),e.onerror=()=>{console.error("Failed to load Socket.IO from CDN"),this.showFallbackMessage()},document.head.appendChild(e)}else this.connectSocket()}catch(e){console.error("Failed to initialize socket:",e),this.showFallbackMessage()}}showFallbackMessage(){setTimeout((()=>{this.addMessage("I'm currently in offline mode. Please refresh the page to try again.","alfred")}),1e3)}connectSocket(){try{if(!/^(localhost|127\.0\.0\.1)$/.test(location.hostname)&&!this.config.serverUrl)return void(this.socket=null);this.socket=io(this.config.serverUrl,{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,timeout:5e3}),this.socket.on("alfred-response",(e=>{this.addMessage(e.message,"alfred")})),this.socket.on("alfred-error",(()=>{this.addMessage("Sorry, I encountered an error. Please try again.","alfred")})),this.socket.on("connect",(()=>{console.log("Connected to JIA server")})),this.socket.on("connect_error",(e=>{console.warn("Socket connect_error; using HTTP fallback.",e?.message||e)})),this.socket.on("disconnect",(()=>{console.log("Disconnected from JIA server")}))}catch(e){console.error("Failed to connect to JIA server:",e)}}togglePanel(){this.isOpen?this.closePanel():this.openPanel()}openPanel(){this.isOpen=!0,this.elements.panel.classList.add("open"),this.elements.overlay.classList.add("open"),this.elements.toggle.classList.add("active"),this.elements.input.focus()}closePanel(){this.isOpen=!1,this.elements.panel.classList.remove("open"),this.elements.overlay.classList.remove("open"),this.elements.toggle.classList.remove("active")}sendMessage(){const e=this.elements.input.value.trim();e&&(this.addMessage(e,"user"),this.elements.input.value="",this.autoResizeTextarea(),this.socket&&this.socket.connected?this.socket.emit("chat-message",{message:e,sessionId:this.sessionId}):fetch(`${this.config.serverUrl}/api/chat/message`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,sessionId:this.sessionId})}).then((e=>e.ok?e.json():Promise.reject(new Error("HTTP error")))).then((e=>this.addMessage(e.content,"alfred"))).catch((()=>this.addMessage("Sorry, I encountered an error. Please try again.","alfred"))))}addMessage(e,t){const n=document.createElement("div");n.className=`alfred-widget-message ${t}`;const i="alfred"===t?"fas fa-robot":"fas fa-user";n.innerHTML=`\n                <div class="alfred-widget-message-avatar">\n                    <i class="${i}"></i>\n                </div>\n                <div class="alfred-widget-message-bubble">\n                    <div class="markdown-body">${this.formatMessage(e)}</div>\n                </div>\n            `,this.elements.chat.appendChild(n);try{if(window.hljs){n.querySelectorAll("pre code").forEach((e=>window.hljs.highlightElement(e)))}}catch(e){}this.scrollToBottom()}normalizeInlineLists(e){try{if(!e||"string"!=typeof e)return e;if(/(^|\n)\s*(?:[-*+]\s+|\d+\.[\t ]+)/.test(e))return e;let t=e.replace(/:\s*\*\s+/g,":\n- ");return t=t.replace(/\s\*\s+/g,"\n- "),t=t.replace(/\n{3,}/g,"\n\n"),t}catch(t){return e}}formatMessage(e){let t=e;try{const n=this.normalizeInlineLists(e);if(window.marked)t=window.marked.parse(n);else{const e=/(https?:\/\/[^\s]+)/g;t=n.replace(e,'<a href="$1" target="_blank" rel="noopener noreferrer nofollow">$1</a>')}}catch(e){}try{if(window.DOMPurify)return window.DOMPurify.sanitize(t,{USE_PROFILES:{html:!0},ADD_ATTR:["target","rel","class"],ALLOWED_TAGS:["a","p","br","span","div","strong","em","del","code","pre","blockquote","hr","ul","ol","li","h1","h2","h3","h4","h5","h6","table","thead","tbody","tr","th","td"]})}catch(e){}return t}configureMarkdown(){const e=e=>new Promise((t=>{if(Array.from(document.scripts).some((t=>t.src===e)))return t();const n=document.createElement("script");n.src=e,n.onload=t,n.onerror=t,document.head.appendChild(n)})),t=(e,t)=>{if(Array.from(document.querySelectorAll('link[rel="stylesheet"]')).some((t=>t.href===e)))return;const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.media=t),document.head.appendChild(n)};t("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css","(prefers-color-scheme: light)"),t("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css","(prefers-color-scheme: dark)"),Promise.all([e("https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"),e("https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"),e("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js")]).then((()=>{try{if(window.marked){window.marked.setOptions({gfm:!0,breaks:!0,headerIds:!0,mangle:!1,highlight:(e,t)=>window.hljs?t&&window.hljs.getLanguage(t)?window.hljs.highlight(e,{language:t}).value:window.hljs.highlightAuto(e).value:e});const e=new window.marked.Renderer;e.link=(e,t,n)=>`<a href="${e}"${t?` title="${t}"`:""} target="_blank" rel="noopener noreferrer nofollow">${n}</a>`,window.marked.use({renderer:e})}}catch(e){}}))}autoResizeTextarea(){const e=this.elements.input;e.style.height="auto",e.style.height=Math.min(e.scrollHeight,100)+"px"}scrollToBottom(){setTimeout((()=>{this.elements.chat.scrollTop=this.elements.chat.scrollHeight}),100)}generateSessionId(){return"widget_session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{window.alfredWidget=new i(e)})):window.alfredWidget=new i(e)}();